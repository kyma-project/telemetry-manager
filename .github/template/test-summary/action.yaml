name: Test Summary
description: Downloads test artifacts and publishes consolidated test reports

inputs:
  github-token:
    description: Github token to use for github access
    required: true
  report-pattern:
    description: Pattern to match report artifacts
    required: false
    default: "*-report"
  report-path:
    description: Path where reports will be downloaded
    required: false
    default: "reports"

runs:
  using: "composite"

  steps:
    - name: Download JUnit reports
      uses: actions/download-artifact@634f93cb2916e3fdff6788551b99b062d0335ce0 # v5.0.0
      with:
        path: ${{ inputs.report-path }}
        pattern: ${{ inputs.report-pattern }}
        merge-multiple: true

    - name: Publish JUnit reports as GHA Summary
      uses: mikepenz/action-junit-report@3585e9575db828022551b4231f165eb59a0e74e3 # v5.6.2
      if: always()
      with:
        report_paths: "${{ inputs.report-path }}/junit-report*.xml"
        summary: true
        detailed_summary: true
        fail_on_failure: true
        include_passed: true
        skip_annotations: true
        token: ${{ inputs.github-token }}
