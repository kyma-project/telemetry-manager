apiVersion: v1
kind: ConfigMap
metadata:
  labels:
    app.kubernetes.io/name: telemetry-logpipelines
    busola.io/extension: resource
    busola.io/extension-version: "0.5"
  name: logpipelines
data:
  details: |-
    header:
      - source: >-
          $each(spec.output, function($v, $k) {$v.url.value or
          $v.url.valueFrom.secretKeyRef.name or $v.host.value or
          $v.host.valueFrom.secretKeyRef.name ? $k})
        placeholder: custom
        type: string
        name: Type
        isSelected: true
        widget: Text
      - name: Unsupported-Mode
        source: status.unsupportedMode
        widget: Badge
        highlights:
          positive:
            - 'false'
          negative:
            - 'true'
    body:
      - source: $filter(status.conditions, function ($v) { $v.type != "Pending" and $v.type != "Running" })
        widget: Table
        name: Reconciliation Conditions
        children:
          - source: type
            name: Type
          - source: status
            name: Status
            widget: Badge
            highlights:
              success:
                - 'True'
              error:
                - 'False'
          - source: reason
            name: Reason
          - source: message
            name: Message
          - source: '$readableTimestamp(lastTransitionTime)'
            name: Last transition
            sort: true
      - widget: Panel
        name: Applications
        children:
          - widget: Panel
            name: Namespaces
            children:
              - name: Include
                widget: JoinedArray
                source: spec.input.application.namespaces.include
                separator: ', '
              - name: Exclude
                widget: JoinedArray
                source: spec.input.application.namespaces.exclude
                separator: ', '
              - name: System Namespaces
                source: spec.input.application.namespaces.system
          - widget: Panel
            name: Containers
            children:
              - name: Include
                widget: JoinedArray
                source: spec.input.application.containers.include
                separator: ', '
              - name: Exclude
                widget: JoinedArray
                source: spec.input.application.containers.exclude
                separator: ', '
          - widget: Panel
            name: Other Settings
            children:
              - name: Keep Annotations
                source: spec.input.application.keepAnnotations
              - name: Drop Labels
                source: spec.input.application.dropLabels
      - widget: Panel
        name: Output
        children:
          - name: Custom
            widget: CodeViewer
            language: '''plaintext'''
            source: spec.output.custom
            visibility: $exists(spec.output.custom)
          - name: Grafana-Loki
            widget: Panel
            visibility: $not($exists(spec.output.custom) or $exists(spec.output.http))
            children:
              - name: URL
                source: spec.output.`grafana-loki`.url.value
              - name: Labels
                widget: Labels
                source: spec.output.`grafana-loki`.labels
              - name: Remove keys
                widget: JoinedArray
                separator: ','
                source: spec.output.`grafana-loki`.removeKeys
          - name: HTTP
            widget: Panel
            visibility: $exists(spec.output.http)
            children:
              - name: Host
                widget: Panel
                children:
                  - name: Value
                    source: spec.output.http.host.value
                    visibility: $exists(spec.output.http.host.value)
                  - name: Value From Secret
                    widget: ResourceRefs
                    source: spec.output.http.host.valueFrom.secretKeyRef
                    kind: Secret
                    visibility: $exists(spec.output.http.host.valueFrom.secretKeyRef.name)
              - name: User
                widget: Panel
                children:
                  - name: Value
                    source: spec.output.http.user.value
                    visibility: $exists(spec.output.http.user.value)
                  - name: Value From Secret
                    widget: ResourceRefs
                    source: spec.output.http.user.valueFrom.secretKeyRef
                    kind: Secret
                    visibility: $exists(spec.output.http.user.valueFrom.secretKeyRef.name)
              - name: Password
                widget: Panel
                children:
                  - name: Value
                    source: spec.output.http.password.value
                    visibility: $exists(spec.output.http.password.value)
                  - name: Value From Secret
                    widget: ResourceRefs
                    source: spec.output.http.password.valueFrom.secretKeyRef
                    kind: Secret
                    visibility: $exists(spec.output.http.password.valueFrom.secretKeyRef.name)
              - name: TLS Settings
                widget: Panel
                children:
                  - name: Disabled
                    source: spec.output.http.tls.disabled
                    placeholder: 'false'
                  - name: Skip certificate validation
                    source: spec.output.http.tls.skipCertificateValidation
                    placeholder: 'false'
                  - name: Ca
                    widget: Panel
                    visibility: $exists(spec.output.http.tls.ca)
                    source: spec.output.http.tls.ca
                    children:
                      - name: Value
                        source: value
                        visibility: $exists(value)
                      - name: Value From Secret
                        widget: ResourceRefs
                        source: valueFrom.secretKeyRef
                        kind: Secret
                        visibility: $exists(valueFrom.secretKeyRef.name)
                  - name: Cert
                    widget: Panel
                    visibility: $exists(spec.output.http.tls.cert)
                    source: spec.output.http.tls.cert
                    children:
                      - name: Value
                        source: value
                        visibility: $exists(value)
                      - name: Value From Secret
                        widget: ResourceRefs
                        source: valueFrom.secretKeyRef
                        kind: Secret
                        visibility: $exists(valueFrom.secretKeyRef.name)
                  - name: Key
                    widget: Panel
                    visibility: $exists(spec.output.http.tls.key)
                    source: spec.output.http.tls.key
                    children:
                      - name: Value
                        source: value
                        visibility: $exists(value)
                      - name: Value From Secret
                        widget: ResourceRefs
                        source: valueFrom.secretKeyRef
                        kind: Secret
                        visibility: $exists(valueFrom.secretKeyRef.name)
              - name: Other Settings
                widget: Panel
                children:
                  - name: Compression
                    source: spec.output.http.compress
                  - name: De-dot
                    source: spec.output.http.dedot
                    placeholder: 'false'
                  - name: Format
                    source: spec.output.http.format
                    placeholder: json
                  - name: Port
                    source: spec.output.http.port
                    placeholder: '443'
                  - name: URI
                    source: spec.output.http.uri
  form: |
    - path: spec.input
      widget: FormGroup
      defaultExpanded: true
      children:
        - name: Include Namespaces
          widget: SimpleList
          path: application.namespaces.include
          defaultExpanded: true
          inputInfo: Include container logs from selected namespaces
          children:
            - path: '[]'
        - name: Exclude Namespaces
          widget: SimpleList
          path: application.namespaces.exclude
          children:
            - path: '[]'
        - name: Include System Namespaces
          path: application.namespaces.system
        - name: Include Containers
          widget: SimpleList
          path: application.containers.include
        - name: Exclude Containers
          widget: SimpleList
          path: application.containers.exclude
        - name: Keep Annotations
          path: application.keepAnnotations
        - name: Drop Labels
          path: application.dropLabels
    - name: Filters
      widget: SimpleList
      path: spec.filters
      children:
        - widget: FormGroup
          path: '[]'
          children:
            - widget: CodeEditor
              path: custom
    - path: spec.output
      widget: FormGroup
      defaultExpanded: true
      simple: true
      children:
        - name: Custom
          path: custom
          widget: CodeEditor
          advanced: true
          inputInfo: >-
            Note: If you use a custom output, you put the LogPipeline in unsupported
            mode
            (https://kyma-project.io/#/telemetry-manager/user/02-logs?id=unsupported-mode)
        - name: HTTP
          path: http
          widget: FormGroup
          defaultExpanded: true
          simple: true
          children:
            - name: Host
              path: host
              simple: true
              widget: FormGroup
              children:
                - name: Value
                  path: value
                  simple: true
                  widget: Text
                - name: Secret Reference
                  path: valueFrom.secretKeyRef
                  simple: true
                  widget: ResourceRef
                  resource:
                    kind: secret
                    version: v1
                  children:
                    - path: key
                      simple: true
                      enum: $keys($secret.data)
            - name: User
              path: user
              simple: true
              widget: FormGroup
              children:
                - name: Value
                  path: value
                  simple: true
                  widget: Text
                - name: Secret Reference
                  path: valueFrom.secretKeyRef
                  simple: true
                  widget: ResourceRef
                  resource:
                    kind: secret
                    version: v1
                  children:
                    - path: key
                      simple: true
                      enum: $keys($secret.data)
            - name: Password
              path: password
              simple: true
              widget: FormGroup
              children:
                - name: Value
                  path: value
                  simple: true
                  widget: Text
                - name: Secret Reference
                  path: valueFrom.secretKeyRef
                  simple: true
                  widget: ResourceRef
                  resource:
                    kind: secret
                    version: v1
                  children:
                    - path: key
                      simple: true
                      enum: $keys($secret.data)
            - name: TLS
              widget: FormGroup
              path: tls
              children:
                - name: Disabled
                  path: disabled
                - name: Skip Certificate Validation
                  path: skipCertificateValidation
                - name: CA
                  path: ca
                  widget: FormGroup
                  simple: true
                  children:
                    - name: Value
                      path: value
                      widget: Text
                      simple: true
                    - name: Secret Reference
                      path: valueFrom.secretKeyRef
                      widget: ResourceRef
                      simple: true
                      resource:
                        kind: secret
                        version: v1
                      children:
                        - simple: true
                          path: key
                          enum: $keys($secret.data)
                - name: Cert
                  path: cert
                  widget: FormGroup
                  simple: true
                  children:
                    - name: Value
                      path: value
                      widget: Text
                      simple: true
                    - name: Secret Reference
                      path: valueFrom.secretKeyRef
                      widget: ResourceRef
                      simple: true
                      resource:
                        kind: secret
                        version: v1
                      children:
                        - simple: true
                          path: key
                          enum: $keys($secret.data)
                - name: Key
                  path: key
                  widget: FormGroup
                  simple: true
                  children:
                    - name: Value
                      path: value
                      widget: Text
                      simple: true
                    - name: Secret Reference
                      path: valueFrom.secretKeyRef
                      widget: ResourceRef
                      simple: true
                      resource:
                        kind: secret
                        version: v1
                      children:
                        - simple: true
                          path: key
                          enum: $keys($secret.data)
            - name: URI
              path: uri
              widget: Text
            - name: Port
              path: port
              widget: Text
            - name: Compress
              path: compress
              widget: Text
            - name: Format
              path: format
              widget: Text
            - name: Dedot
              simple: true
              path: dedot
  general: |-
    resource:
      kind: LogPipeline
      group: telemetry.kyma-project.io
      version: v1alpha1
    name: Log Pipelines
    category: Observability
    urlPath: logpipelines
    scope: cluster
    description: >-
      {{[LogPipeline](https://kyma-project.io/#/telemetry-manager/user/resources/02-logpipeline)}} configures log selection, filters, and outputs.
  list: |-
    - source: >-
        $each(spec.output, function($v, $k) {$v.url.value or
        $v.url.valueFrom.secretKeyRef.name or $v.host.value or
        $v.host.valueFrom.secretKeyRef.name ? $k})
      placeholder: custom
      type: string
      name: Type
      isSelected: true
      widget: Text
    - name: Unsupported-Mode
      source: status.unsupportedMode
      widget: Badge
      highlights:
        positive:
          - 'false'
        negative:
          - 'true'
    - name: Status
      source: $filter(status.conditions, function ($v) { $v.type != "Pending" and $v.type != "Running" })
      widget: Columns
      children:
        - name: Type
          source: type
          widget: Badge
        - name: Status
          source: status
          widget: Badge
          highlights:
            success:
              - 'True'
            error:
              - 'False'
