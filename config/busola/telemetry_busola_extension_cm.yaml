apiVersion: v1
kind: ConfigMap
metadata:
  labels:
    app.kubernetes.io/name: telemetry-module
    busola.io/extension: resource
    busola.io/extension-version: "0.5"
  name: module
data:
  details: |
    header:
      - name: State
        source: status.state
        widget: Badge

    body:
      - name: Traces
        widget: Panel
        visibility: $exists(spec.trace.gateway.scaling.static.replicas)
        children:
        - name: Gateway Replicas
          source: spec.trace.gateway.scaling.static.replicas
        - name: Scaling Type
          source: spec.trace.gateway.scaling.type
      - name: Metrics
        widget: Panel
        visibility: $exists(spec.metric.gateway.scaling.static.replicas)
        children:
        - name: Gateway Replicas
          source: spec.metric.gateway.scaling.static.replicas
        - name: Scaling Type
          source: spec.metric.gateway.scaling.type
      - name: Status
        widget: Panel
        children:
        - source: status.endpoints.traces.grpc
          name: OTLP GRPC Trace Endpoint
        - source: status.endpoints.traces.http
          name: OTLP HTTP Trace Endpoint
        - source: status.endpoints.metrics.grpc
          name: OTLP GRPC Metric Endpoint
        - source: status.endpoints.metrics.http
          name: OTLP HTTP Metric Endpoint
      - source: status.conditions
        widget: Table
        name: Reconciliation Conditions
        children:
          - source: type
            name: Type
          - source: status
            name: Status
            widget: Badge
            highlights:
              success:
                - 'True'
              error:
                - 'False'
          - source: reason
            name: Reason
          - source: message
            name: Message
          - source: '$readableTimestamp(lastTransitionTime)'
            name: Last transition
            sort: true
  form: |
    - advanced: true
      defaultExpanded: false
      readOnly: false
      decodable: false
      path: spec.trace
      name: Traces
      widget: FormGroup
      children:
        - advanced: true
          defaultExpanded: false
          readOnly: false
          decodable: false
          path: gateway
          name: Gateway
          widget: FormGroup
          children:
            - advanced: true
              defaultExpanded: false
              readOnly: false
              decodable: false
              path: scaling
              name: Scaling
              widget: FormGroup
              children:
                - path: type
                  override: false
                  enum:
                    - None
                - advanced: true
                  defaultExpanded: false
                  readOnly: false
                  decodable: false
                  visibility: "$item.spec.trace.gateway.scaling.type = 'Static'"
                  path: static
                  name: Static
                  widget: FormGroup
                  children:
                    - advanced: true
                      defaultExpanded: false
                      readOnly: false
                      decodable: false
                      path: replicas
                      name: Replicas
                      simple: false
                      widget: Text
    - advanced: true
      defaultExpanded: false
      readOnly: false
      decodable: false
      path: spec.metric
      name: Metrics
      widget: FormGroup
      children:
        - advanced: true
          defaultExpanded: false
          readOnly: false
          decodable: false
          path: gateway
          name: Gateway
          widget: FormGroup
          children:
            - advanced: true
              defaultExpanded: false
              readOnly: false
              decodable: false
              path: scaling
              name: Scaling
              widget: FormGroup
              children:
                - path: type
                  override: false
                  enum:
                    - None
                - advanced: true
                  defaultExpanded: false
                  readOnly: false
                  decodable: false
                  visibility: "$item.spec.metric.gateway.scaling.type = 'Static'"
                  path: static
                  name: Static
                  widget: FormGroup
                  children:
                    - advanced: true
                      defaultExpanded: false
                      readOnly: false
                      decodable: false
                      path: replicas
                      name: Replicas
                      simple: false
                      widget: Text

  general: |
    resource:
      kind: Telemetry
      group: operator.kyma-project.io
      version: v1alpha1
    name: Telemetry
    category: Kyma
    urlPath: telemetries
    scope: namespace
    description: >-
      {{[Telemetry custom resource](https://kyma-project.io/#/telemetry-manager/user/resources/01-telemetry)}} configures the Telemetry module.
    features:
      actions:
        disableCreate: true
        disableDelete: true
  list: |
    - name: State
      source: status.state
      widget: Badge
