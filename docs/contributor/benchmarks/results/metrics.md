# Test Results: Metrics

## Overview

The expected throughput for the agent receiver is ~20K metrics/sec. Expected memory usage is on average ~700MB, and CPU usage is ~0.2 for each instance.
The expected throughput for the gateway receiver on the receiver side is ~4K metrics/sec for single-pipeline scenarios and ~3K metrics/sec for multi-pipeline scenarios. Exported data should be 3 times the received spans. The backpressure scenarios should return the exporter queue size between ~300 and 512 for both single- and multi-pipeline scenarios, and the gateway instances should not crash.
On average, memory usage for gateway instances is ~150MB for a single Pod, and CPU usage is ~1.5 for non-backpressure scenarios (slightly higher for multi-pipeline scenarios). In backpressure scenarios, the behaviour is different: The expected CPU usage should be less than in non-backpressure scenarios, because less data is processed and exported compared to non-backpressure scenarios. The expected memory usage is significantly higher than in non-backpressure scenarios.
> **NOTE:** The figures above are the minimum acceptable values. You should always compare the measured results with the previous execution from the table to check for performance degradations, typically indicated by higher CPU or memory usage, lower throughput, or higher queue size.
> The test execution is automated. If the test results aren't as expected, you should re-execute the test to confirm the results.

## Results Gateway

|              Version/Test | Single-Pipeline (ci-metrics) |                              |                     |                      |               | Multi-Pipeline (ci-metrics-m) |                              |                     |                      |               | Single-Pipeline Backpressure (ci-metrics-b) |                              |                     |                      |               | Multi-Pipeline Backpressure (ci-metrics-mb) |                              |                     |                      |               |
|--------------------------:|:----------------------------:|:----------------------------:|:-------------------:|:--------------------:|:-------------:|:-----------------------------:|:----------------------------:|:-------------------:|:--------------------:|:-------------:|:-------------------------------------------:|:----------------------------:|:-------------------:|:--------------------:|:-------------:|:-------------------------------------------:|:----------------------------:|:-------------------:|:--------------------:|:-------------:|
|                           | Receiver Accepted Metric/sec | Exporter Exported Metric/sec | Exporter Queue Size | Pod Memory Usage(MB) | Pod CPU Usage | Receiver Accepted Metric/sec  | Exporter Exported Metric/sec | Exporter Queue Size | Pod Memory Usage(MB) | Pod CPU Usage |        Receiver Accepted Metric/sec         | Exporter Exported Metric/sec | Exporter Queue Size | Pod Memory Usage(MB) | Pod CPU Usage |        Receiver Accepted Metric/sec         | Exporter Exported Metric/sec | Exporter Queue Size | Pod Memory Usage(MB) | Pod CPU Usage |
|                      0.92 |             5992             |             5993             |          0          |       225, 178       |   1.6, 1.5    |             4882              |            14647             |          0          |       165, 255       |   1.7, 1.8    |                     635                     |             636              |         114         |       770, 707       |     0, 0      |                     965                     |             1910             |         400         |      1694, 1500      |   0.1, 0.1    |
|                      0.93 |             5592             |             5593             |          0          |       104, 100       |   1.6, 1.5    |             4721              |            14164             |          0          |       161, 175       |   1.8, 1.7    |                     723                     |             634              |         217         |       805, 889       |   1.4, 1.4    |                    1492                     |             1740             |         419         |      1705, 1535      |    0.2, 0     |
|                      0.94 |             5836             |             5835             |          0          |       164, 244       |   1.6, 1.4    |             4873              |            14619             |          0          |       157, 228       |   1.8, 1.5    |                     870                     |             667              |         297         |       954, 782       |   0.3, 0.8    |                    1443                     |             1811             |         59          |      903, 1075       |    0, 0.1     |
|                      0.95 |             6092             |             6091             |          0          |       96, 117        |   1.5, 1.5    |             5275              |            15827             |          0          |       185, 151       |   1.8, 1.7    |                     735                     |             634              |         243         |       824, 896       |     0, 0      |                    2325                     |             1809             |         170         |      1446, 1601      |   1.5, 1.6    |
|                      0.96 |             4690             |             4689             |          0          |       171, 115       |   1.4, 1.4    |             4249              |            12748             |          0          |       156, 167       |   1.6, 1.6    |                     710                     |             577              |         226         |       717, 860       |   0.5, 1.1    |                    2638                     |             1738             |         165         |      1998, 1618      |   0.3, 0.3    |
|                      0.97 |             4509             |             4510             |          0          |       107, 106       |   1.3, 1.4    |             4103              |            12308             |          0          |       171, 190       |   1.4, 1.6    |                     787                     |             681              |         261         |       710, 959       |   0.8, 1.2    |                    2710                     |             1847             |         170         |      1891, 1765      |   1.1, 1.2    |
|        0.97 w. GOMEMLIMIT |             4576             |             4576             |          0          |       107, 123       |   1.4, 1.4    |             3840              |            11522             |          0          |       148, 156       |   1.6, 1.5    |                     805                     |             585              |         347         |       781, 769       |   1.4, 1.4    |                    3690                     |             1828             |         170         |      1766, 1783      |   1.5, 1.6    |
|                      0.99 |             4530             |             4531             |          0          |        97, 95        |   1.3, 1.4    |             4086              |            12259             |          0          |       179, 162       |   1.4, 1.6    |                     821                     |             609              |         388         |       756, 781       |    1.1, 1     |                    3604                     |             1743             |         170         |      1778, 1853      |   1.6, 1.5    |
|                   0.100.0 |             4249             |             4249             |          0          |       120, 130       |   1.3, 1.4    |             3804              |            11413             |          0          |       193, 153       |   1.6, 1.3    |                     781                     |             590              |         367         |       743, 787       |   0.9, 0.5    |                    3370                     |             1924             |         170         |      1538, 1956      |   1.6, 1.6    |
|                   0.102.1 |             4453             |             4454             |          0          |       100, 90        |   1.3, 1.3    |             3814              |            11445             |          0          |       187, 213       |   1.5, 1.4    |                     774                     |             553              |         375         |       783, 788       |    0, 0.1     |                    3333                     |             1805             |         170         |      1550, 1946      |   1.7, 1.7    |
|             0.102.1 (new) |             3868             |             3869             |          0          |       131, 107       |   1.2, 1.4    |             3958              |            11875             |          0          |       255, 178       |   1.5, 1.6    |                     840                     |             628              |         382         |       918, 888       |   0.5, 0.5    |                    3264                     |             1900             |         168         |      1843, 1648      |   1.6, 1.6    |
|                   0.103.0 |             4665             |             4666             |          0          |       109, 132       |   1.4, 1.4    |             3913              |            11743             |          0          |       219, 156       |   1.6, 1.7    |                     798                     |             597              |         327         |       863, 843       |   0.4, 0.4    |                    3102                     |             1841             |         169         |      1826, 1799      |   1.6, 1.6    |
|                   0.104.0 |             4906             |             4906             |          0          |       131, 134       |   1.4, 1.4    |             4177              |            12536             |          0          |       197, 234       |   1.7, 1.6    |                     800                     |             567              |         387         |       879, 829       |   0.5, 0.5    |                    3268                     |             1804             |         170         |      1848, 1802      |   1.6, 1.6    |
|                   0.105.0 |             4546             |             4546             |          0          |       137, 142       |   1.5, 1.5    |             3165              |             9500             |          1          |       221, 224       |   1.7, 1.7    |                     807                     |             642              |         310         |       841, 825       |   0.5, 0.5    |                    2083                     |             1872             |         504         |      1755, 1747      |   1.4, 1.4    |
|                   0.107.0 |             4702             |             4703             |          0          |       142, 150       |   1.5, 1.5    |             3354              |            10061             |          0          |       223, 234       |   1.7, 1.7    |                     768                     |             576              |         323         |       860, 831       |   0.5, 0.5    |                    1867                     |             1831             |         378         |      1713, 1689      |   1.3, 1.3    |
|                   0.108.1 |             4352             |             4353             |          0          |       134, 148       |   1.5, 1.5    |             3190              |             9574             |          0          |       243, 248       |   1.7, 1.7    |                     794                     |             650              |         271         |       849, 873       |   0.5, 0.5    |                    1830                     |             1828             |         502         |      1576, 1702      |   1.3, 1.3    |
| 0.108.1 (with connectors) |             4500             |             4500             |          0          |       149, 143       |   1.5, 1.5    |             3232              |             9697             |          0          |       245, 243       |   1.7, 1.7    |                     800                     |             588              |         346         |       830,820        |   0.5, 0.5    |                    1976                     |             1886             |         505         |      1769,1547       |   1.4, 1.4    |
|                   0.109.0 |             4332             |             4332             |          0          |       236, 198       |   1.5, 1.5    |             3511              |            10533             |          0          |       241, 224       |   1.7, 1.8    |                     667                     |             484              |         378         |       854, 812       |   0.4, 0.4    |                    2440                     |             1937             |         508         |      1624, 1800      |   1.5, 1.5    |
|                   0.110.0 |             4223             |             4222             |          0          |       130, 137       |   1.5, 1.5    |             3139              |             9417             |          1          |       197, 215       |   1.7, 1.7    |                     830                     |             640              |         287         |       841, 835       |   0.5, 0.5    |                    2048                     |             1907             |         510         |      1741, 1694      |   1.4, 1.4    |
|                   0.114.0 |             4384             |             4385             |          0          |       131, 141       |   1.5, 1.5    |             3209              |             9624             |          0          |       189, 198       |   1.7, 1.8    |                     757                     |             635              |         393         |       807, 824       |   0.5, 0.4    |                    2512                     |             1691             |         510         |      1788, 1789      |   1.6, 1.6    |
|                   0.115.0 |             4256             |             4255             |          0          |       144, 175       |   1.5, 1.5    |             3346              |            10040             |          0          |       244, 202       |   1.7, 1.8    |                     726                     |             627              |         361         |       821, 834       |   0.5, 0.5    |                    2510                     |             1926             |         505         |      1778, 1730      |   1.7, 1.6    |
|                   0.116.0 |             4374             |             4374             |          0          |       100, 109       |   1.5, 1.5    |             3500              |            10500             |          0          |       171, 171       |    1.8, 2     |                     710                     |             641              |         383         |       857, 870       |   0.5, 0.5    |                    3183                     |             1780             |         509         |      1760, 1848      |    2, 2.1     |
|                   0.118.0 |             4357             |             4357             |          0          |       120, 115       |   1.5, 1.5    |             3520              |            10566             |          0          |       151, 179       |    2, 1.8     |                     813                     |             522              |         443         |      880, 1752       |   0.6, 0.6    |                    3264                     |             1925             |         510         |      1837, 1855      |    2, 2.1     |
|                   0.120.0 |             4175             |             4177             |          1          |       137, 110       |   1.5, 1.5    |             3424              |            10275             |          5          |       171, 175       |    2, 1.9     |                     698                     |             696              |         314         |       824, 831       |   0.5, 0.5    |                    2962                     |             1729             |         509         |      1639, 1787      |     2, 2      |
|                   0.122.1 |             4314             |             4315             |          2          |       139, 133       |   1.5, 1.4    |             3471              |            10418             |          5          |       206, 173       |    2, 1.8     |                     749                     |             699              |         342         |       865, 867       |   0.6, 0.5    |                    3029                     |             1988             |         507         |      1869, 1863      |    2, 2.1     |
|                   0.123.0 |             4358             |             4359             |          2          |       105, 123       |   1.4, 1.5    |             3654              |            10961             |          6          |       164, 164       |    1.8, 2     |                     585                     |             561              |         363         |       800, 892       |   0.5, 0.4    |                    3147                     |             1813             |         510         |      1737, 1825      |     2, 2      |
|                   0.124.0 |             5169             |             5170             |          2          |       106, 115       |   1.5, 1.6    |             4137              |            12412             |          3          |       180, 182       |   2.1, 1.9    |                     617                     |             646              |         306         |       850, 887       |   0.5, 0.4    |                    3055                     |             1869             |         402         |      1747, 1804      |   1.8, 1.9    |
|                   0.126.0 |             5311             |             5311             |          2          |       157, 99        |   1.5, 1.5    |             4093              |            12278             |          6          |       182, 169       |   1.8, 2.1    |                     440                     |             553              |         255         |       848, 878       |   0.3, 0.3    |                    3474                     |             1914             |         510         |      1832, 1839      |     2, 2      |
|                   0.127.0 |             5263             |             5264             |          2          |       111,118        |    1.5,1.6    |             4143              |            12427             |          6          |       180,165        |     2,1.8     |                     554                     |             567              |         307         |       865,902        |    0.4,0.5    |                    3523                     |             1827             |         510         |      1833,1896       |     2.1,2     |
|                   0.128.0 |             4993             |             4993             |          2          |       109,115        |    1.5,1.5    |             4082              |            12246             |          9          |       182,196        |     2,1.8     |                     624                     |             626              |         297         |       882,851        |    0.5,0.5    |                    3496                     |             1929             |         510         |      1820,1816       |      2,2      |
|                   0.129.0 |             5182             |             5180             |          4          |       115,119        |    1.6,1.5    |             3782              |            11347             |          6          |       181,165        |    1.7,2.1    |                     653                     |             690              |         309         |       861,877        |    0.4,0.5    |                    3488                     |             1866             |         509         |      1846,1766       |    2.1,1.9    |
|                   0.130.1 |             5105             |             5105             |          2          |       132,103        |    1.6,1.5    |             3983              |            11952             |          6          |       182,360        |    2.1,1.8    |                     640                     |             562              |         367         |       927,887        |    0.5,0.5    |                    3547                     |             1825             |         508         |      1858,1807       |      2,2.1    |

## Test Results: Agent


|       Version/Test | Single-Pipeline (ci-metric-ag) |                              |                     |                      |               | Single-Pipeline Backpressure (ci-metric-ag-b) |                              |                     |                      |               |
|-------------------:|:------------------------------:|:----------------------------:|:-------------------:|:--------------------:|:-------------:|:---------------------------------------------:|:----------------------------:|:-------------------:|:--------------------:|:-------------:|
|                    |  Receiver Accepted Metric/sec  | Exporter Exported Metric/sec | Exporter Queue Size | Pod Memory Usage(MB) | Pod CPU Usage |         Receiver Accepted Metric/sec          | Exporter Exported Metric/sec | Exporter Queue Size | Pod Memory Usage(MB) | Pod CPU Usage |
|               0.92 |             20123              |            20137             |          0          |       704, 747       |   0.2, 0.2    |                     19952                     |            15234             |          0          |       751, 736       |   0.3, 0.2    |
|               0.93 |             19949              |            19946             |          0          |       704, 729       |   0.2, 0.2    |                     16699                     |            16591             |         107         |       852, 771       |   0.2, 0.2    |
|               0.94 |             19957              |            19950             |          0          |       727, 736       |   0.2, 0.4    |                     19825                     |            19824             |          0          |      1046, 1090      |   0.2, 0.2    |
|               0.95 |             19648              |            19645             |          0          |       707, 734       |   0.3, 0.2    |                     19717                     |            19818             |          0          |       657, 996       |   0.2, 0.3    |
|               0.96 |             19937              |            19905             |         29          |       749, 699       |   0.2, 0.2    |                     19843                     |            19766             |         70          |       840, 995       |   0.2, 0.2    |
|               0.97 |             20120              |            20122             |          0          |       937, 996       |   0.2, 0.2    |                     19667                     |            19665             |          0          |       900, 961       |   0.3, 0.2    |
| 0.97 w. GOMEMLIMIT |             219981             |            19980             |          0          |       802, 689       |   0.2, 0.2    |                     19736                     |            19743             |          0          |       783, 862       |   0.2, 0.2    |
|               0.99 |             20139              |            20138             |          0          |       749, 792       |   0.2, 0.2    |                     20170                     |            20155             |          6          |       721, 730       |   0.2, 0.2    |
|            0.100.0 |             20067              |            20049             |          9          |       704, 700       |   0.2, 0.2    |                     20011                     |            20011             |          0          |       780, 704       |   0.2, 0.2    |
|            0.102.1 |             19883              |            19884             |          0          |       776, 733       |   0.2, 0.2    |                     20085                     |            20080             |          0          |       776, 718       |   0.2, 0.2    |
|      0.102.1 (new) |             20007              |            19989             |         15          |       697, 713       |   0.2, 0.2    |                     19967                     |            19964             |          0          |       731, 683       |   0.2, 0.2    |
|            0.103.0 |             19994              |            20038             |          0          |       684, 670       |   0.2, 0.2    |                     19989                     |            19998             |          0          |       724, 671       |   0.2, 0.2    |
|            0.104.0 |             19906              |            19898             |          6          |       689, 744       |   0.2, 0.2    |                     19818                     |            19823             |          0          |       685, 685       |   0.2, 0.2    |
|            0.105.0 |             20128              |            20126             |          0          |       767, 734       |   0.2, 0.2    |                     20084                     |            20093             |          0          |       692, 727       |   0.2, 0.2    |
|            0.107.0 |             20065              |            20136             |          0          |       735, 706       |   0.2, 0.2    |                     19885                     |            19887             |          0          |       725, 665       |   0.2, 0.2    |
|            0.108.1 |             20219              |            20217             |          0          |       743, 751       |   0.2, 0.2    |                     20120                     |            20108             |          6          |       735, 780       |   0.2, 0.2    |
|            0.109.0 |             20098              |            20106             |          0          |       738, 747       |   0.2, 0.2    |                     20079                     |            20072             |          0          |       854, 845       |   0.3, 0.3    |
|            0.110.0 |             20240              |            20238             |          0          |       733, 773       |   0.3, 0.3    |                     20060                     |            20059             |          0          |       764, 735       |   0.2, 0.3    |
|            0.114.0 |             19904              |            19904             |          0          |       683, 707       |   0.2, 0.2    |                     19942                     |            19958             |          0          |       701, 743       |   0.2, 0.2    |
|            0.115.0 |             20073              |            20073             |          0          |       697, 697       |   0.2, 0.2    |                     19924                     |            19954             |          0          |       700, 773       |   0.2, 0.3    |
|            0.116.0 |             20058              |            20057             |          0          |       690, 682       |   0.3, 0.3    |                     19998                     |            19999             |          0          |       713, 692       |   0.2, 0.3    |
|            0.118.0 |             19859              |            19859             |          0          |       694, 672       |   0.2, 0.2    |                     20057                     |            20057             |          0          |       661, 664       |   0.2, 0.2    |
|            0.120.0 |             20018              |            20017             |          0          |       733, 720       |   0.2, 0.2    |                     19803                     |            19803             |          0          |       698, 661       |   0.3, 0.2    |
|            0.122.1 |             19977              |            19978             |          0          |       703, 665       |   0.2, 0.2    |                     19845                     |            19845             |          0          |       673, 701       |   0.2, 0.2    |
|            0.123.0 |             20026              |            20038             |          0          |       690, 669       |   0.3, 0.3    |                     19850                     |            19842             |         19          |       694, 675       |   0.2, 0.2    |
|            0.124.0 |             19913              |            19913             |          0          |       707, 728       |   0.3, 0.2    |                     19975                     |            19976             |          0          |       687, 708       |   0.2, 0.3    |
|            0.126.0 |             19946              |            19945             |          0          |       776, 682       |   0.2, 0.2    |                     20164                     |            20300             |          0          |       671, 709       |   0.3, 0.2    |
|            0.127.0 |             20027              |            20034             |          9          |       691,682        |    0.3,0.3    |                     19775                     |            19775             |          0          |       686,650        |    0.3,0.2    |
|            0.128.0 |             20177              |            20176             |          0          |       673,718        |    0.3,0.2    |                     19961                     |            19961             |          0          |       730,693        |    0.2,0.3    |
|            0.129.0 |             19983              |            19984             |          0          |       729,714        |   0.2,0.2     |                     19900                     |            19901             |          0          |       677,762        |   0.2,0.2     |
|            0.130.1 |             20055              |            20047             |          9          |       500,488        |   0.2,0.2     |                     19855                     |            19855             |          0          |       456,478        |   0.2,0.3     |
